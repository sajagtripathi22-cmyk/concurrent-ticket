// ---- transfer.js ----
import express from "express";
import bodyParser from "body-parser";

const app = express();
const PORT = 3000;
app.use(bodyParser.json());

// ------------------ Mock Account Data ------------------
let accounts = [
  { id: 1, name: "Alice", balance: 1000 },
  { id: 2, name: "Bob", balance: 800 },
  { id: 3, name: "Charlie", balance: 500 },
];

// ------------------ Helper Functions ------------------
function findAccount(id) {
  return accounts.find((acc) => acc.id === id);
}

// ------------------ Routes ------------------

// Home
app.get("/", (req, res) => {
  res.send(`
    <h1>ğŸ¦ Account Transfer System</h1>
    <p>Try these endpoints:</p>
    <ul>
      <li>GET /accounts â€” View all accounts</li>
      <li>POST /transfer â€” Transfer money between accounts</li>
    </ul>
    <p>Example body for /transfer:</p>
    <pre>{
  "fromId": 1,
  "toId": 2,
  "amount": 100
}</pre>
  `);
});

// Get all accounts
app.get("/accounts", (req, res) => {
  res.json(accounts);
});

// Transfer money
app.post("/transfer", (req, res) => {
  const { fromId, toId, amount } = req.body;

  // Validate input
  if (!fromId || !toId || !amount) {
    return res.status(400).json({ message: "Missing fromId, toId, or amount." });
  }

  if (fromId === toId) {
    return res.status(400).json({ message: "Cannot transfer to the same account." });
  }

  const sender = findAccount(fromId);
  const receiver = findAccount(toId);

  if (!sender || !receiver) {
    return res.status(404).json({ message: "Invalid account ID(s)." });
  }

  if (amount <= 0) {
    return res.status(400).json({ message: "Transfer amount must be positive." });
  }

  // Balance validation
  if (sender.balance < amount) {
    return res.status(400).json({ message: "Insufficient balance." });
  }

  // Perform transfer
  sender.balance -= amount;
  receiver.balance += amount;

  console.log(`ğŸ’¸ Transferred ${amount} from ${sender.name} to ${receiver.name}.`);

  res.json({
    message: `âœ… Transfer successful.`,
    from: { name: sender.name, balance: sender.balance },
    to: { name: receiver.name, balance: receiver.balance },
  });
});

// Reset all accounts
app.post("/reset", (req, res) => {
  accounts = [
    { id: 1, name: "Alice", balance: 1000 },
    { id: 2, name: "Bob", balance: 800 },
    { id: 3, name: "Charlie", balance: 500 },
  ];
  res.json({ message: "Accounts reset to default balances.", accounts });
});

// ------------------ Start Server ------------------
app.listen(PORT, () => {
  console.log(`ğŸš€ Account Transfer System running on http://localhost:${PORT}`);
});
