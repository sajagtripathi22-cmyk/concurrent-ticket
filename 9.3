// ---- app.js ----
import express from "express";
import path from "path";
import { fileURLToPath } from "url";
import os from "os";

const __dirname = path.dirname(fileURLToPath(import.meta.url));
const app = express();
const PORT = process.env.PORT || 8080;

// -------- Simulate Backend API --------
app.use(express.json());
app.use(express.static("public"));

app.get("/api/hello", (req, res) => {
  const instance = os.hostname(); // simulate load balancer target
  res.json({
    message: `Hello from backend instance: ${instance}`,
    time: new Date().toLocaleTimeString(),
  });
});

// -------- Frontend (React-like HTML) --------
app.get("/", (req, res) => {
  res.send(`
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Full Stack JS App on AWS</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 60px; background: #111; color: #f5f5f5; }
  button { padding: 10px 20px; margin-top: 20px; border: none; background: #00bcd4; color: #fff; font-size: 16px; cursor: pointer; border-radius: 8px; }
  button:hover { background: #0097a7; }
  #response { margin-top: 30px; font-size: 18px; color: #8bc34a; }
</style>
</head>
<body>
  <h1>ðŸš€ Full Stack JavaScript App</h1>
  <p>This simulates a full deployment on AWS with load balancing.</p>
  <button onclick="callAPI()">Call Backend API</button>
  <div id="response"></div>
  <script>
    async function callAPI() {
      const res = await fetch('/api/hello');
      const data = await res.json();
      document.getElementById('response').innerHTML = 
        '<b>' + data.message + '</b><br/>Time: ' + data.time;
    }
  </script>
</body>
</html>
  `);
});

// -------- Start Server --------
app.listen(PORT, () => {
  console.log(`âœ… Server running on http://localhost:${PORT}`);
  console.log(`Simulating AWS Load Balancer target: ${os.hostname()}`);
});
